totalFind = 20
letterCount = 11 
withNumber = true
idDoor = "Passworld"

storageBlast = ""
doorBlast = ""

withJammer = true 
withWL = true 
doorId = 12
enteranceId = 5542

delayWarp = 7000

webhooNya = ""
msgId = ""

bot = getBot()
nuked = false
t = os.time()
totalWorld = 0
worldList = {}

function round(n)
    return n % 1 > 0.5 and math.ceil(n) or math.floor(n)
end

function placeIt(x,y,id)
    while getTile(getBot().x + x,getBot().y + y).fg ~= id do
        bot:place(getBot().x + x,getBot().y + y,id)
        sleep(160)
    end
end

function warp(world,id) 
    local suck = 0 
    addEvent(Event.variantlist, function(variant, netid)
        if variant:get(0):getString() == "OnConsoleMessage" then
            if variant:get(1):getString():find("inaccessible") then
                nuked = true
            end
        end
    end)
    while not bot:isInWorld(world:upper()) and not nuked do 
        while bot.status ~= BotStatus.online do 
            sleep(1000)
        end
        if suck == 10 then 
            sleep(300000)
        else
            if bot:isInWorld() then 
                bot:sendPacket(3,"action|quit_to_exit")
                sleep(500)
                bot:sendPacket(3,"action|join_request\nname|"..world:upper().."|"..id:upper().."\ninvitedWorld|0")
                listenEvents(1)
                sleep(delayWarp)
            else 
               bot:sendPacket(3,"action|join_request\nname|"..world:upper().."|"..id:upper().."\ninvitedWorld|0")
                listenEvents(1)
               sleep(delayWarp)
            end
            suck = suck + 1
        end
    end
    if id ~= "" and bot:getWorld():getTile(bot.x,bot.y).fg == 6 and not nuked then 
        local wrongDoor = 0 
        while bot:getWorld():getTile(bot.x,bot.y).fg == 6 and wrongDoor ~= 5 do 
            if wrongDoor == 5 then 
                sleep(100)
                bot:stopScript()
            else
                bot:sendPacket(3,"action|join_request\nname|"..world:upper().."|"..id:upper().."\ninvitedWorld|0")
                listenEvents(3)
                wrongDoor = wrongDoor + 1
            end
        end
    end
end

function takeSupply(world,door,id,amount)
    bot.auto_collect = false
    sleep(100)
    warp(world,door)
    sleep(100)
    if not nuked then 
        for _,obj in pairs(bot:getWorld():getObjects()) do 
            if obj.id == id then
                bot:findPath(round(obj.x/32),math.floor(obj.y/32))
                sleep(100)
                bot:collectObject(obj.oid,3)
                sleep(100)
            end
            if bot:getInventory():findItem(id) > 0 then 
                break
            end
        end
        bot:moveTo(-1,0)
        sleep(500)
        bot:setDirection(false)
        sleep(100)
        if bot:getInventory():findItem(id) > amount then
            while bot:getInventory():findItem(id) ~= amount do 
                bot:sendPacket(2,"action|drop\n|itemID|"..id)
                sleep(500)
                bot:sendPacket(2,"action|dialog_return\ndialog_name|drop_item\nitemID|"..id.."|\ncount|"..bot:getInventory():findItem(id) - amount)
                sleep(3000)
            end
        end
    else 
        -- nuked
        print(world:upper().." Nuked !")
    end
end

function supplay()
    while bot.status ~= BotStatus.online do 
        sleep(100)
    end
    takeSupply(storageBlast,doorBlast,1402,totalFind)
    sleep(100)
    if withJammer then 
        takeSupply(storageBlast,doorBlast,226,totalFind)
        sleep(100)
    end
    if withWL then 
        takeSupply(storageBlast,doorBlast,242,totalFind)
        sleep(100)
    else 
        takeSupply(storageBlast,doorBlast,2,totalFind)
    end
    takeSupply(storageBlast,doorBlast,202,totalFind)
    sleep(100)
    takeSupply(storageBlast,doorBlast,enteranceId,totalFind)
    sleep(100)
    takeSupply(storageBlast,doorBlast,doorId,totalFind)
    sleep(100)
end

function log(txt)
    file = io.open(getBot().name..".txt", "a")
    if file then
        file:write(txt.."\n")
        file:close()
    end
end

function name(count)
    if withNumber then
        local str = ""
        local chars = "abcdefghijklmnopqrstuvwxyz0123456789"
        for i = 1, count do
            local randomIndex = math.random(1, #chars)
            str = str .. chars:sub(randomIndex, randomIndex)
        end
        return str:upper()
    else
        local str = ""
        for i = 1, count do
            str = str..string.char(math.random(97,122))
        end
        return str:upper()
    end
end
function edit(x,y,id)
    bot:wrench(getBot().x + x,getBot().y + y)
    sleep(1000)
    bot:sendPacket(2,"action|dialog_return\ndialog_name|door_edit\ntilex|"..(getBot().x + x).."|\ntiley|"..(getBot().y + y).."|\ndoor_name|\ndoor_target|\ndoor_id|"..id.."\ncheckbox_locked|1")
    sleep(1000)
end
function reapply(x,y)
    bot:wrench(getBot().x + x,getBot().y + y)
    sleep(1000)
    bot:sendPacket(2,"action|dialog_return\ndialog_name|lock_edit\ntilex|"..(getBot().x + x).."|\ntiley|"..(getBot().y + y).."|\nbuttonClicked|recalcLock\n\ncheckbox_public|0\ncheckbox_ignore|1")
    sleep(1000)
end

function public(x,y)
    bot:wrench(getBot().x + x,getBot().y + y)
    sleep(1000)
    bot:sendPacket(2,"action|dialog_return\ndialog_name|lock_edit\ntilex|"..(getBot().x + x).."|\ntiley|"..(getBot().y + y).."|\ncheckbox_public|1\ncheckbox_disable_music|0\ntempo|100\ncheckbox_disable_music_render|0\ncheckbox_set_as_home_world|0\nminimum_entry_level|1")
    sleep(1000)
end

function reconnect(world,door,x,y)
    if bot.status == BotStatus.online and bot.x ~= x or bot.y ~= y then 
        while not bot:isInWorld(world:upper()) and not nuked do 
            while bot.status ~= BotStatus.online do 
                sleep(1000)
            end
            warp(world,door)
            sleep(100)
        end
        if door ~= "" and bot:getWorld():getTile(bot.x,bot.y).fg == 6 then 
            while bot:getWorld():getTile(bot.x,bot.y).fg == 6 and not nuked do 
                warp(world,door)
            end
        end
        if x and y and math.floor(bot:getWorld():getLocal().posx/32) ~= x or math.floor(bot:getWorld():getLocal().posy/32) ~= y then 
            sleep(100)
            while math.floor(bot:getWorld():getLocal().posx/32) ~= x or math.floor(bot:getWorld():getLocal().posy/32) ~= y do 
                bot:findPath(x,y)
            end
        end
    elseif bot.status ~= BotStatus.online then 
            sleep(100)
        while not bot:isInWorld(world:upper()) and not nuked do 
            while bot.status ~= BotStatus.online do 
                sleep(1000)
            end
            warp(world,door)
            sleep(100)
        end
        if door ~= "" and bot:getWorld():getTile(bot.x,bot.y).fg == 6 then 
            while bot:getWorld():getTile(bot.x,bot.y).fg == 6 and not nuked do 
                warp(world,door)
            end
        end
        if x and y and math.floor(bot:getWorld():getLocal().posx/32) ~= x or math.floor(bot:getWorld():getLocal().posy/32) ~= y then 
            while math.floor(bot:getWorld():getLocal().posx/32) ~= x or math.floor(bot:getWorld():getLocal().posy/32) ~= y do 
                bot:findPath(x,y)
            end
        end
    end
end

function wHook(webH,status)
    te = os.time() - t
    local syn = Webhook.new(webH)
    syn.avatar_url = "https://cdn.discordapp.com/attachments/1180523579381665933/1180577805403181076/20231203_013427.png"
    syn.embed1.use = true 
    syn.embed1.title = "<:lucisyn:1240609594842026016> AutoFind Soil Farm"
    syn.embed1.color = 16740100
    syn.embed1.thumbnail = "https://cdn.discordapp.com/attachments/1180523579381665933/1180577805403181076/20231203_013427.png"
    syn.embed1.description = ""
    syn.embed1.footer.icon_url = "https://cdn.discordapp.com/attachments/1180523579381665933/1180577805403181076/20231203_013427.png"
    syn.embed1:addField("","Bot Info\n"..status,true)
    syn.embed1:addField("","Bot Name\n"..bot.name,true)
    syn.embed1:addField("Total world ( "..totalWorld.." )",waktuWorld(),true)
    syn.embed1:addField("UPTIME","<:arrow:1231993245144318083>"..math.floor(te/86400).." Days "..math.floor(te%86400/3600).." Hours "..math.floor(te%86400%3600/60).." Minutes",false)
    syn.embed1.footer.text = "Lucifer Blast By SYN \n"..os.date("!%a %b %d, %Y at %I:%M %p", os.time() + 7 * 60 * 60)
    syn:edit(msgId)
end

function waktuWorld()
    strWaktu = ""
    for _,worldzz in pairs(worldList) do
        strWaktu = strWaktu.."\n<:arrow:1160743652088365096> "..worldzz:upper()
    end
    return strWaktu
end

supplay()
for i = 1,totalFind do
    while bot.status ~= BotStatus.online do 
        sleep(1000)
    end
    local world = ""
    sleep(100)
    local world = name(letterCount)
    sleep(100)
    if bot:getInventory():findItem(1402) > 0 then 
        local blast = bot:getInventory():findItem(1402)
        bot:place(bot.x,bot.y,1402)
        sleep(1000)
        bot:sendPacket(2,"action|dialog_return\ndialog_name|terraformer_reply\nitemID|1402|\nworldname|"..world:upper())
        sleep(5000)
        if bot:getInventory():findItem(1402) < blast and not bot:isInWorld(world:upper()) then 
            warp(world,"")
            sleep(100)
        end
        if #worldList > 10 then 
            worldList = {}
            waktu = {}
        end
        totalWorld = totalWorld + 1
        wHook(webhooNya,"Start "..world:upper())
        if bot:isInWorld(world:upper()) and bot:getWorld():getTile(bot.x,bot.y).fg == 6 then 
            if math.floor(bot:getWorld():getLocal().posx/32) == 99 then 
                reconnect(world,"",99,53)
                placeIt(-1,-1,226)
                sleep(200)
                reconnect(world,"",99,53)
                bot:hit(bot.x -1,bot.y -1)
                sleep(200)
                reconnect(world,"",99,53)
                placeIt(0,-1,enteranceId)
                sleep(200)
                reconnect(world,"",99,53)
                placeIt(-1,-2,202)
                sleep(200)
                reconnect(world,"",99,53) 
                placeIt(0,-2,doorId)
                reconnect(world,"",99,53)
                sleep(100)
                if withWL then 
                    reconnect(world,"",99,53)
                    placeIt(-1,0,242)
                    sleep(200)
                else
                    reconnect(world,"",99,53)
                    placeIt(-1,0,2)
                    sleep(100)
                end
                reconnect(world,"",99,53)
                reapply(-1,-2)
                sleep(200)
                if withWL then 
                    reconnect(world,"",99,53)
                    public(-1,0)
                    sleep(200)
                end
                reconnect(world,"",99,53)
                edit(0,-2,idDoor)
                sleep(100)
            else 
                reconnect(world,"",0,53)
                placeIt(1,1,226)
                sleep(200)
                reconnect(world,"",0,53)
                bot:hit(bot.x + 1,bot.y + 1)
                sleep(200)
                reconnect(world,"",0,53)
                placeIt(0,-1,enteranceId)
                sleep(200)
                reconnect(world,"",0,53)
                placeIt(1,-2,202)
                sleep(200)
                reconnect(world,"",0,53)
                placeIt(0,-2,doorId)
                sleep(100)
                if withWL then 
                    reconnect(world,"",0,53)
                    placeIt(1,0,242)
                    sleep(200)
                else
                    reconnect(world,"",0,53)
                    placeIt(1,0,2)
                    sleep(100)
                end
                reconnect(world,"",0,53)
                reapply(1,-2)
                sleep(200)
                if withWL then 
                    reconnect(world,"",0,53)
                    public(1,0)
                    sleep(200)
                end
                reconnect(world,"",0,53)
                edit(0,-2,idDoor)
            end
        end
        table.insert(worldList,world)
        sleep(100)
        log(world:upper()..":"..idDoor:upper())
        sleep(100)
        wHook(webhooNya,world:upper().." Done")
    end
end